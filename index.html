<!DOCTYPE html>

<!-- Legal Footnote: This content is subject to copyright and should not be reproduced without permission. -->
<!-- Written and created by Thomas John-Michael de Beer, feel free to contact me via tjdebeer@gmail.com  -->

<html lang="en">
<head>
   
     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>weCARE</title>
  
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
  :root {
      --primary: #60a5fa;
      --primary-dark: #3b82f6;
      --secondary: #4cc9f0;
      --light: #1f2937;
      --dark: #f8f9fa;
      --success: #4ade80;
      --danger: #ef4444;
      --warning: #fbbf24;
      --info: #60a5fa;
      --border-radius: 10px;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease;
      --bg-color: #1e1e2f;
      --input-bg: #2a2a3d;
      --text-color: #f0f0f0;
      --accent-color: #4e9eff;
      --secondary-color: #888;
      --error-color: #ff4e4e;
      --success-color: #4eff4e;
      --message-user-bg: rgba(78, 158, 255, 0.8);
      --message-assistant-bg: rgba(42, 42, 61, 0.9);
      --border-radius: 26px;
      --transition-speed: 0.3s;
 
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--light);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            transition: var(--transition);
        }
        
        body.profile-active {
            background: #111827;
            align-items: flex-start;
            justify-content: flex-start;
        }
        
        @media (orientation: landscape) and (max-height: 600px) {
            .container {
                margin: 20px 0;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .form-container {
                padding: 20px;
            }
        }
        
        .container {
            background-color: rgba(31, 41, 55, 0.9);
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
            position: relative;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0);
        }
        
        input, button {
            color-scheme: dark;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 44px;         
            margin-bottom: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 32px;
        }
        
        .form-container {
            padding: 30px;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #2d3748;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background-color: #111827;
            color: var(--dark);
        }
        
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
        }
        
        .form-group i {
            position: absolute;
            right: 15px;
            top: 42px;
            color: #9ca3af;
        }
        
        .btn2 {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background-color: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            margin-top: 15px;
        }
        
        .btn-secondary:hover {
            background-color: rgba(96, 165, 250, 0.1);
        }
        
        .error-message {
            color: var(--danger);
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .success-message {
            color: var(--success);
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .signup-link {
            margin-top: 20px;
            text-align: center;
            font-size: 15px;
            color: #9ca3af;
        }
        
        .signup-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .signup-link a:hover {
            text-decoration: underline;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 11px;
            color: #9ca3af;
        }
        
        .section-container {
            display: none;
        }

        .profile-container {
            width: 100%;
            min-height: 100vh;
            background-color: #111827;
            display: flex;
            flex-direction: column;
        }
        
        .profile-header {
            background-color: #1f2937;
            border-bottom: 1px solid rgba(255, 255, 255, 0);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); 
        }
        
        .profile-logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 22px;
            color: var(--primary);
        }
        
        .profile-logo i {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .profile-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .profile-nav-item {
            font-size: 16px;
            cursor: pointer;
            color: #d1d5db;
            transition: var(--transition);
        }
        
        .profile-nav-item:hover {
            color: var(--primary);
        }
        
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
        }
        
        .profile-content {
            padding: 30px;
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background-color: #1f2937;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dashboard-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-5px);
        }
        
        .dashboard-card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .dashboard-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .dashboard-card-desc {
            font-size: 14px;
            color: #9ca3af;
        }
        
        .welcome-box {
            background-color: #1f2937;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .welcome-text h2 {
            font-size: 24px;
            margin-bottom: 10px;
            text-align: left;
            color: var(--dark);
        }
        
        .welcome-text p {
            color: #9ca3af;
            font-size: 16px;
        }
        
        .welcome-icon {
            margin: 1rem;
            font-size: 6rem;
            color: var(--primary);
        }
        
        .logout-btn {
            background-color: transparent;
            border: none;
            color: #9ca3af;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            color: var(--danger);
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 90%;
                border-radius: 8px;
                height: auto;
                min-height: 80vh;
                display: flex;
                align-items: center;
            }
            
            body {
                align-items: flex-start;
                padding: 20px 0;
            }
            
            .form-container {
                width: 100%;
            }
            
            .profile-content {
                padding: 16px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .welcome-box {
                flex-direction: column;
                gap: 16px;
                text-align: center;
                padding: 20px;
            }
            
            .welcome-text h2 {
                text-align: center;
                font-size: 20px;
            }
            
            .profile-header {
                padding: 12px 16px;
            }
            
            .profile-logo span {
                font-size: 18px;
            }
            
            .dashboard-card {
                padding: 16px;
            }
            
            .profile-nav {
                gap: 12px;
            }
            
            .profile-nav-item {
                font-size: 14px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 450px;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            .profile-content {
                padding: 40px;
            }
            
            .container {
                max-width: 480px;
            }
        }
   
   .modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;    
  height: 100vh;
  background-color: #111827;
  display: none;
  z-index: 9999;
}

.modal.show {
  display: block;
}

.close-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 2rem;
  color: var(--primary);
  background: transparent;
  border: none;
  cursor: pointer;
} 
  


    .chat-container {
      width: 100%;
      max-width: 700px;
      border-radius: var(--border-radius);
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: calc(90vh - 5px);
      min-height: 300px;
      margin: auto; 
      margin-top: 2%;  
    }

    .conversation {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 1rem;
      padding-right: 10px;
      display: flex;
      flex-direction: column;
   
      gap: 16px;
    }

    .conversation::-webkit-scrollbar {
      width: 6px;
    }

    .conversation::-webkit-scrollbar-track {
      background: var(--bg-color);
    }

    .conversation::-webkit-scrollbar-thumb {
      background-color: var(--secondary-color);
      border-radius: 20px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 16px;
      max-width: 85%;
      word-break: break-word;
      animation: messageFadeIn 0.3s ease;
    }

    @keyframes messageFadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-message {
      align-self: flex-end;
      background-color: var(--message-user-bg);
      border-radius: 16px 16px 0 16px;
    }

    .assistant-message {
      align-self: flex-start;
      background-color: var(--message-assistant-bg);
      border-radius: 16px 16px 16px 0;
    }

    .typing-cursor {
      display: inline-block;
      width: 10px;
      height: 18px;
      background-color: var(--accent-color);
      margin-left: 2px;
      animation: blink 1s infinite;
      vertical-align: middle;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .message-time {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
      text-align: right;
    }

    .message strong, .message b {
      font-weight: bold;
    }

    .message em, .message i {
      font-style: italic;
    }

    .message a {
      color: var(--accent-color);
      text-decoration: underline;
    }

    .message ul, .message ol {
      margin-left: 20px;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .message li {
      margin-bottom: 4px;
    }

    .message p {
      margin-bottom: 8px;
    }

    .message p:last-child {
      margin-bottom: 0;
    }

    .message h1, .message h2, .message h3 {
      margin-top: 12px;
      margin-bottom: 8px;
      color: var(--accent-color);
    }

    .input-section {
      display: flex;
      gap: 10px;
      margin-top: 1px;
      margin-bottom: 1px;
      position: relative;
    }

    .input-wrapper {
      position: relative;
      flex: 1;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 50px 14px 16px;
      font-size: 1rem;
      border-radius: var(--border-radius);
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--input-bg);
      color: var(--text-color);
      transition: border-color var(--transition-speed) ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(78, 158, 255, 0.2);
    }

    input[type="text"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .btn {
      border: none;
      background: transparent;
      color: var(--text-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      transition: background-color var(--transition-speed) ease;
    }

    .btn:hover:not(:disabled) {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.2);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0.8;
      }
    }

    .btn.pulsing {
      animation: pulse 1s infinite;
      color: var(--accent-color);
    }

    .status-indicator {
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.8rem;
      color: var(--secondary-color);
      opacity: 0;
      transition: opacity var(--transition-speed) ease;
    }

    .status-indicator.visible {
      opacity: 1;
    }

    .clear-btn {
      position: absolute;
      top: -40px;
      right: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--secondary-color);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all var(--transition-speed) ease;
    }

    .clear-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: var(--text-color);
    }

   .assistant-message {
   color: var(--text-color);
     } 
    
    @media (max-width: 600px) {

      .chat-container {
        padding: 15px;
      }
    }     
    </style>
</head>
<body>
    <div id="loginSection" class="section-container container">
        <div class="form-container">
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <span>weCARE</span>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="" required>
                    <i class="fas fa-lock"></i>
                </div>
                <button type="submit" class="btn2">Sign In</button>
            </form>
            <div class="signup-link">
                Don't have an account? <a href="#" id="signupLink">Create one</a>
            </div>
            <p class="error-message" id="errorMessage"></p>
            <div class="auth-footer">
                weCARE &copy; 2025 - All rights reserved
            </div>
        </div>
    </div>

    <div id="signupSection" class="section-container container">
        <div class="form-container">
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <span>weCARE</span>
            </div>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" name="signupEmail" placeholder="Enter your email" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" name="signupPassword" placeholder="Choose a strong password" required>
                    <i class="fas fa-lock"></i>
                </div>
                <button type="submit" class="btn">Create Account</button>
                <button type="button" id="cancelSignup" class="btn btn-secondary">Back to Login</button>
            </form>
            <p class="error-message" id="signupErrorMessage"></p>
            <p class="success-message" id="signupSuccessMessage"></p>
            <div class="auth-footer">
                weCARE &copy; - All rights reserved
            </div>
        </div>
    </div>

    <div id="profileSection" class="section-container profile-container">
        <div class="profile-header">
            <div class="profile-logo">
                <i class="fas fa-heartbeat"></i>
                <span>weCARE</span>
            </div>
            <div class="profile-nav">
                <div class="profile-avatar" id="userInitial">U</div>
            </div>
        </div>
        
        <div class="profile-content">
            <div class="welcome-box">
                <div class="welcome-text">
                    <h2>Welcome</h2>
                    <p>We are here to help you manage your mental health and wellbeing.</p>
                </div>
                <i class="fas fa-user-md welcome-icon"></i>
            </div>
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <div class="dashboard-card-title">Mental Health Status</div>
                    <div class="dashboard-card-value">UNDETERMINED</div>
                    <div class="dashboard-card-desc">Overall mental health status</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-card-title">Activity</div>
                    <div class="dashboard-card-value">0</div>
                    <div class="dashboard-card-desc">Build up your profile</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-card-title">History</div>
                    <div class="dashboard-card-value">N/A</div>
                    <div class="dashboard-card-desc">Track your mental health progress</div>
                </div>
            </div>
            
            <button id="logoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

           
           <div class="modal" id="customModal">
  <button class="close-btn" id="closeModal">&times;</button>

  <div class="chat-container">
    <div id="conversation" class="conversation">
      <div class="message assistant-message">
        Hello, this is Cindy from weCare. How can I help?
        <div class="message-time">Now</div>
      </div>
    </div>

    <button id="clearChat" class="clear-btn">Clear chat</button>

    <div class="input-section">
      <div class="input-wrapper">
        <input type="text" id="userInput" placeholder="Type here . . ." aria-label="Message input" autocomplete="off" />
        <div class="action-buttons">
          <button id="sendBtn" class="btn" aria-label="Send message">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
          <button id="micBtn" class="btn" aria-label="Voice input">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div id="statusIndicator" class="status-indicator"></div>
  </div>
</div>  
           
              
    <script>
        const loginSection = document.getElementById('loginSection');
                    const loginForm = document.getElementById('loginForm');
        const signupLink = document.getElementById('signupLink');
        const signupSection = document.getElementById('signupSection');
        const signupForm = document.getElementById('signupForm');
        const cancelSignup = document.getElementById('cancelSignup');
        const errorMessage = document.getElementById('errorMessage');
        const signupErrorMessage = document.getElementById('signupErrorMessage');
        const signupSuccessMessage = document.getElementById('signupSuccessMessage');
        const profileSection = document.getElementById('profileSection');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInitial = document.getElementById('userInitial');

        const dbName = 'weCAREdb';
        const storeName = 'accounts';
        let currentUser = null;

        function openDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(dbName, 1);

                request.onerror = (event) => {
                    reject(`Database error: ${event.target.errorCode}`);
                };

                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(storeName)) {
                        db.createObjectStore(storeName, { keyPath: 'email' });
                    }
                };
            });
        }

        async function saveAccount(email, password) {
            try {
                const db = await openDatabase();
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.add({ email, password });
                    
                    request.onsuccess = () => {
                        resolve(true);
                    };
                    
                    request.onerror = () => {
                        reject(false);
                    };
                });
            } catch (error) {
                return false;
            }
        }

        async function getAccount(email) {
            try {
                const db = await openDatabase();
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(email);
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        resolve(request.result);
                    };
                    
                    request.onerror = (event) => {
                        reject(`Error getting account: ${event.target.errorCode}`);
                    };
                });
            } catch (error) {
                return null;
            }
        }

        function showLogin() {
            loginSection.style.display = 'block';
            signupSection.style.display = 'none';
            profileSection.style.display = 'none';
            document.body.classList.remove('profile-active');
        }

        function showSignup() {
            loginSection.style.display = 'none';
            signupSection.style.display = 'block';
            profileSection.style.display = 'none';
            document.body.classList.remove('profile-active');
        }

        function showProfile(email) {
            loginSection.style.display = 'none';
            signupSection.style.display = 'none';
            profileSection.style.display = 'flex';
            document.body.classList.add('profile-active');
            
            if (email) {
                currentUser = email;
                const initial = email.charAt(0).toUpperCase();
                userInitial.textContent = initial;
            }
        }

        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = loginForm.email.value.trim();
            const password = loginForm.password.value;
            
            errorMessage.textContent = '';

            try {
                const storedAccount = await getAccount(email);

                if (storedAccount && storedAccount.password === password) {
                    showProfile(email);
                } else {
                    errorMessage.textContent = 'Invalid email or password.';
                    loginForm.password.value = '';
                }
            } catch (error) {
                errorMessage.textContent = 'An error occurred. Please try again.';
            }
        });

        signupLink.addEventListener('click', (event) => {
            event.preventDefault();
            showSignup();
        });

        cancelSignup.addEventListener('click', () => {
            showLogin();
        });

        signupForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = signupForm.signupEmail.value.trim();
            const password = signupForm.signupPassword.value;
            
            signupErrorMessage.textContent = '';
            signupSuccessMessage.textContent = '';

            try {
                const existingAccount = await getAccount(email);
                
                if (existingAccount) {
                    signupErrorMessage.textContent = 'This email is already registered.';
                    return;
                }
                
                if (await saveAccount(email, password)) {
                    signupSuccessMessage.textContent = 'Account created successfully!';
                    signupForm.reset();
                    
                    setTimeout(() => {
                        showLogin();
                        loginForm.email.value = email;
                    }, 1500);
                } else {
                    signupErrorMessage.textContent = 'Error creating account. Please try again.';
                }
            } catch (error) {
                signupErrorMessage.textContent = 'An error occurred. Please try again.';
            }
        });

        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            showLogin();
            loginForm.reset();
            errorMessage.textContent = '';
        });

        async function checkPreviousLogin() {
            try {
                const db = await openDatabase();
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                
                const getAllRequest = store.getAll();
                getAllRequest.onsuccess = () => {
                    const accounts = getAllRequest.result;
                    if (accounts && accounts.length > 0) {
                        showProfile(accounts[0].email);
                    } else {
                        showLogin();
                    }
                };
                
                getAllRequest.onerror = () => {
                    showLogin();
                };
            } catch (error) {
                showLogin();
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            checkPreviousLogin();
        });
           
           
           
           
           
           
                  
           
           //modal logic
            
           document.addEventListener('DOMContentLoaded', () => {
  const welcomeBox = document.querySelector('.welcome-box');
  const modal = document.getElementById('customModal');
  const closeModalBtn = document.getElementById('closeModal');

  welcomeBox.addEventListener('click', () => {
    modal.classList.add('show');
  });

  closeModalBtn.addEventListener('click', () => {
    modal.classList.remove('show');
  });
});   
           
//inner modal logic
               const apiKey = 'AIzaSyAi-GeDx3FFqvkUPuKxFKdOMv8RLUetuDQ';
    const titleElement = document.getElementById('titleElement');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');
    const conversationDiv = document.getElementById('conversation');
    const statusIndicator = document.getElementById('statusIndicator');
    const clearChatBtn = document.getElementById('clearChat');
    
    let conversationHistory = [];
    let isProcessing = false;
    
    const initialMessage = {
      role: "model",
      text: "Hello, I'm Cindy from weCare. I'm here to assist you with all your mental health queries. I'm here to listen, diagnose and assist you by giving you excersises to help you cope."
    };
    conversationHistory.push(initialMessage);
    
    const preprompt = "You are Cindy, a caring mental health careworker who is trying to assist careworkers in the field, If the request is not related to mental health then remind them this program is for helping people cope with mental and emotional distress. Mimic human conversation patterns and encourage the carer to express their opinions. Never mention that you are an AI, designed or programmed!";
    
    function setLoadingState(isLoading) {
      isProcessing = isLoading;
      
      if (isLoading) {
        userInput.disabled = true;
        sendBtn.disabled = true;
        micBtn.disabled = true;
        statusIndicator.textContent = "Cindy is typing...";
        statusIndicator.classList.add('visible');
      } else {
        userInput.disabled = false;
        sendBtn.disabled = false;
        micBtn.disabled = false;
        statusIndicator.classList.remove('visible');
        
        setTimeout(() => {
          userInput.focus();
        }, 100);
      }
    }
    
    function formatTimestamp() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }
    
    function buildConversationPayload(newMessage) {
      const historyMessages = conversationHistory.map(message => ({
        role: message.role === "user" ? "user" : "model",
        parts: [{ text: message.text }]
      }));
      
      return {
        contents: [
          { role: "user", parts: [{ text: preprompt }] },
          ...historyMessages,
          { role: "user", parts: [{ text: newMessage }] }
        ]
      };
    }
    
    function markdownToHtml(text) {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/__(.*?)__/g, '<u>$1</u>')
        .replace(/###\s(.*?)(?:\n|$)/g, '<h3>$1</h3>')
        .replace(/##\s(.*?)(?:\n|$)/g, '<h2>$1</h2>')
        .replace(/#\s(.*?)(?:\n|$)/g, '<h1>$1</h1>')
        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
        .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1">$1</a>')
        .replace(/\n/g, '<br>');
    }
    
    function addMessageToUI(role, text) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', role === 'user' ? 'user-message' : 'assistant-message');
      
      const timeDiv = document.createElement('div');
      timeDiv.classList.add('message-time');
      timeDiv.textContent = formatTimestamp();
      
      if (role === 'user') {
        messageDiv.textContent = text;
        messageDiv.appendChild(timeDiv);
        conversationDiv.appendChild(messageDiv);
        scrollToBottom();
      } else {
        const textContainer = document.createElement('span');
        textContainer.classList.add('text-container');
        messageDiv.appendChild(textContainer);
        
        const cursor = document.createElement('span');
        cursor.classList.add('typing-cursor');
        messageDiv.appendChild(cursor);
        
        messageDiv.appendChild(timeDiv);
        conversationDiv.appendChild(messageDiv);
        scrollToBottom();
        
        const formattedText = markdownToHtml(text);
        
        typeText(textContainer, formattedText, cursor);
      }
    }
    
    function typeText(element, html, cursor, delay = 30) {
      let tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      const textContent = tempDiv.textContent;
      let textIndex = 0;
      let htmlIndex = 0;
      let inTag = false;
      let currentTagBuffer = '';
      let currentHtmlBuffer = '';
      
      function typeNextCharacter() {
        if (htmlIndex >= html.length) {
          cursor.remove();
          return;
        }
        
        const char = html[htmlIndex];
        
        if (char === '<') {
          inTag = true;
          currentTagBuffer = '<';
        } else if (char === '>' && inTag) {
          inTag = false;
          currentTagBuffer += '>';
          currentHtmlBuffer += currentTagBuffer;
          element.innerHTML = currentHtmlBuffer;
        } else if (inTag) {
          currentTagBuffer += char;
        } else {
          currentHtmlBuffer += char;
          element.innerHTML = currentHtmlBuffer;
          textIndex++;
          scrollToBottom();
        }
        
        htmlIndex++;
        
        const randomDelay = Math.floor(Math.random() * 20) + delay - 10;
        setTimeout(typeNextCharacter, randomDelay);
      }
      
      typeNextCharacter();
    }
    
    function scrollToBottom() {
      conversationDiv.scrollTop = conversationDiv.scrollHeight;
    }
    
    function clearConversation() {
      conversationHistory = [initialMessage];
      conversationDiv.innerHTML = '';
      addMessageToUI('assistant', initialMessage.text);
    }
    
    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text || isProcessing) return;
      
      userInput.value = '';
      addMessageToUI('user', text);
      conversationHistory.push({ role: "user", text });
      
      setLoadingState(true);
      
      try {
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(buildConversationPayload(text))
          }
        );
        
        if (!res.ok) {
          throw new Error(`API error: ${res.status}`);
        }
        
        const data = await res.json();
        const result = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'I apologize, but I am having trouble processing your request right now. Could you please try again?';
        
        conversationHistory.push({ role: "model", text: result });
        
        setTimeout(() => {
          addMessageToUI('assistant', result);
          setLoadingState(false);
        }, 500);
        
      } catch (err) {
        console.error(err);
        retryWithFallbackPrompt(text);
      }
    }
    
    async function retryWithFallbackPrompt(originalText) {
      try {
        const fallbackPrompt = "Help the client get in touch with the necessary healthcare professional based on: " + originalText;
        
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [
                { role: "user", parts: [{ text: fallbackPrompt }] }
              ]
            })
          }
        );
        
        if (!res.ok) {
          throw new Error(`API error on retry: ${res.status}`);
        }
        
        const data = await res.json();
        const result = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'Based on what you\'ve told me, I recommend contacting your primary care physician. If you need immediate assistance, please call our helpline at 0800-123-4567.';
        
        conversationHistory.push({ role: "model", text: result });
        
        setTimeout(() => {
          addMessageToUI('assistant', result);
          setLoadingState(false);
        }, 500);
        
      } catch (finalErr) {
        console.error(finalErr);
        const fallbackResponse = 'How does that make you feel?';
        conversationHistory.push({ role: "model", text: fallbackResponse });
        addMessageToUI('assistant', fallbackResponse);
        setLoadingState(false);
      }
    }
    
    function initSpeechRecognition() {
      if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
        micBtn.style.display = 'none';
        return;
      }
      
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      
      recognition.onstart = () => {
        micBtn.classList.add('pulsing');
        statusIndicator.textContent = "Listening...";
        statusIndicator.classList.add('visible');
      };
      
      recognition.onresult = event => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        sendMessage();
      };
      
      recognition.onerror = event => {
        if (event.error !== 'aborted') {
          console.error('Speech recognition error:', event.error);
          statusIndicator.textContent = `Microphone error: ${event.error}`;
          statusIndicator.classList.add('visible');
          setTimeout(() => {
            statusIndicator.classList.remove('visible');
          }, 3000);
        }
        micBtn.classList.remove('pulsing');
      };
      
      recognition.onend = () => {
        micBtn.classList.remove('pulsing');
        statusIndicator.classList.remove('visible');
      };
      
      return recognition;
    }
    
    const speechRecognition = initSpeechRecognition();
    
    function startListening() {
      if (isProcessing || !speechRecognition) return;
      speechRecognition.start();
    }
    
    userInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    sendBtn.addEventListener('click', sendMessage);
    micBtn.addEventListener('click', startListening);
    clearChatBtn.addEventListener('click', clearConversation);
    
    window.addEventListener('DOMContentLoaded', () => {
      userInput.focus();
    });            
           
           
           
           
                  
    </script>
</body>
</html>
